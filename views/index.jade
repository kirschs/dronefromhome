extends layout

block content
    .row
        .span12
            img(src="/images/DroneFromHome.png")

    .row
        .span5
            div(id="imagediv")
        .span7
            p
            p
            p
            p Control the remote drone with a Quake style interface.
            ul
              li w = forward
              li s = backward
              li d = right
              li a = left
              li shift = start the drone
              li space = land the drone
              li move the mouse to rotate the drone (not yet implemented)
              li click the mouse to shoot (not yet implemented ;)

block append footer
    script(type="text/javascript")
            var imageUrl = "/stream";

            $(document).ready(function () {
                var displayImage = function (base64Data) {
                    var imag = "<img "
                             + "src='" + "data:image/png;base64,"
                             + base64Data + "'/>";

                    $("#imagediv").html(imag)
                };

                var loadImage = function () {
                                    $.ajax({
                                        cache: false,
                                        type: "GET",
                                        url: imageUrl,
                                        success: function (data) {
                                            displayImage(data.base64image);
                                            setTimeout(loadImage, 100);
                                        },
                                        error: function (xhr) {
                                            setTimeout(loadImage, 100);
                                        }
                                    });
                };

                setTimeout(loadImage, 1000);
            });
